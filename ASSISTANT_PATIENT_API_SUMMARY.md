# โ ููุฎุต: API ุงููุณุงุนุฏ ูุฅุฏุงุฑุฉ ุงููุฑุถู

## ๐ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุฅูุดุงุก API endpoint ุฌุฏูุฏ ูุณูุญ ูููุณุงุนุฏ ุงูุฐูู (n8n + WhatsApp) ุจุฅุถุงูุฉ ูุฑุถู ุฌุฏุฏ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

---

## ๐ฏ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ

### ุฑุงุจุท ุงูู API
```
http://localhost:3001/api/create-patient
```

### ุงูุทุฑููุฉ
```
POST
```

### JSON ุงููุทููุจ
```json
{
  "name": "ูุญูุฏ ุฃุญูุฏ",
  "phone": "0501234567"
}
```

---

## ๐ ุงููููุงุช ุงูุชู ุชู ุฅูุดุงุคูุง/ุชุนุฏูููุง

### 1. **server/api.js** โ๏ธ (ูุนุฏูู)
- ุชู ุฅุถุงูุฉ endpoint ุฌุฏูุฏ: `POST /api/create-patient`
- ููุจู ุงูุงุณู ูุงููุงุชู ููุท
- ูุชุญูู ูู ุนุฏู ุงูุชูุฑุงุฑ (ุฑูู ุงููุงุชู)
- ูุฑุฌุน ุฑุณุงุฆู ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ

### 2. **API_CREATE_PATIENT_AR.md** ๐ (ุฌุฏูุฏ)
ุฏููู ุดุงูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุญุชูู ุนูู:
- ุดุฑุญ ุชูุตููู ููู API
- ุฃูุซูุฉ ุนูู ุงูุงุณุชุฌุงุจุงุช
- ุญุงูุงุช ุงูุฎุทุฃ ุงููุฎุชููุฉ
- ููููุฉ ุงูุงุณุชุฎุฏุงู ูู n8n
- ุฃูุซูุฉ ุจู cURL ู Postman
- ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### 3. **QUICK_API_REFERENCE.md** ๐ (ุฌุฏูุฏ)
ูุฑุฌุน ุณุฑูุน ูุญุชูู ุนูู:
- ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ ููู API
- ุฃูุซูุฉ ุณุฑูุนุฉ ููุงุฎุชุจุงุฑ
- ููุงุญุธุงุช ูููุฉ

### 4. **server/API_ENDPOINTS.md** ๐ (ุฌุฏูุฏ)
ุชูุซูู ูุงูู ูุฌููุน ุงูู APIs ุงููุชุงุญุฉ ูู ุงููุธุงู:
- Patients APIs
- Appointments APIs
- Visits APIs
- Statistics APIs
- Webhooks

### 5. **n8n-workflows/create-patient-workflow.json** ๐ (ุฌุฏูุฏ)
Workflow ุฌุงูุฒ ููุงุณุชูุฑุงุฏ ูู n8n ูุญุชูู ุนูู:
- Webhook ููุงุณุชูุจุงู
- ุงูุชุญูู ูู ุงูุจูุงูุงุช
- ุงุณุชุฏุนุงุก ุงูู API
- ูุนุงูุฌุฉ ุงููุฌุงุญ ูุงูุฎุทุฃ

### 6. **n8n-workflows/whatsapp-create-patient-example.json** ๐ (ุฌุฏูุฏ)
Workflow ูุงูู ูุฑุจุท WhatsApp ุจุงูู API:
- ุงุณุชูุจุงู ุฑุณุงุฆู WhatsApp
- ุงุณุชุฎุฑุงุฌ ุงูุงุณู ูุงููุงุชู ูู ุงูุฑุณุงูุฉ
- ุฅูุดุงุก ุงููุฑูุถ
- ุฅุฑุณุงู ุฑุฏ ุชููุงุฆู ูููุณุชุฎุฏู
- ูุนุงูุฌุฉ ุญุงูุงุช ุงูุชูุฑุงุฑ ูุงูุฃุฎุทุงุก

---

## ๐ง ุงููููุฒุงุช ุงููุถุงูุฉ

### โ ุงูุชุญูู ูู ุงูุจูุงูุงุช
- ูุชุฃูุฏ ูู ูุฌูุฏ ุงูุงุณู ูุงููุงุชู
- ูุฑุฌุน ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ูุงูุตุฉ

### โ ููุน ุงูุชูุฑุงุฑ
- ูุชุญูู ูู ุนุฏู ูุฌูุฏ ูุฑูุถ ุจููุณ ุฑูู ุงููุงุชู
- ูุฑุฌุน ุจูุงูุงุช ุงููุฑูุถ ุงูููุฌูุฏ ูู ุญุงูุฉ ุงูุชูุฑุงุฑ

### โ ุชูุธูู ุงูุจูุงูุงุช
- ูุณุชุฎุฏู `.trim()` ูุฅุฒุงูุฉ ุงููุณุงูุงุช ุงูุฒุงุฆุฏุฉ
- ูุถูู ูุธุงูุฉ ุงูุจูุงูุงุช ุงููุฎุฒูุฉ

### โ ุฑุณุงุฆู ุซูุงุฆูุฉ ุงููุบุฉ
- ุฌููุน ุงูุฑุณุงุฆู ูุชููุฑุฉ ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- `message` ู `message_ar`
- `error` ู `error_ar`

### โ HTTP Status Codes ุตุญูุญุฉ
- `201` ูููุฌุงุญ (Created)
- `400` ููุจูุงูุงุช ุงููุงูุตุฉ (Bad Request)
- `409` ููุชูุฑุงุฑ (Conflict)
- `500` ูุฃุฎุทุงุก ุงูุณูุฑูุฑ (Internal Server Error)

---

## ๐ ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู ูู n8n

### ุงูุฎุทูุฉ 1: ุงุณุชูุฑุงุฏ ุงูู Workflow
1. ุงูุชุญ n8n
2. ุงุฐูุจ ุฅูู Workflows
3. ุงุถุบุท Import
4. ุงุฎุชุฑ ููู: `n8n-workflows/whatsapp-create-patient-example.json`

### ุงูุฎุทูุฉ 2: ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช
ูู ุนูุฏ ุฅุฑุณุงู ุงูุฑุณุงุฆูุ ุนุฏูู:
```
http://localhost:3100/message/sendText/YOUR_INSTANCE
```
ุฅูู:
```
http://localhost:3100/message/sendText/YOUR_ACTUAL_INSTANCE_NAME
```

### ุงูุฎุทูุฉ 3: ุชูุนูู ุงูู Workflow
ุงุถุบุท ุนูู Active ูุชูุนูู ุงูู workflow

### ุงูุฎุทูุฉ 4: ุงูุงุฎุชุจุงุฑ
ุฃุฑุณู ุฑุณุงูุฉ ูุงุชุณุงุจ ุจุงูุตูุบุฉ:
```
ูุฑูุถ ุฌุฏูุฏ: ูุญูุฏ ุฃุญูุฏุ 0501234567
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูู API

### PowerShell (Windows):
```powershell
$body = @{
    name = "ูุญูุฏ ุฃุญูุฏ"
    phone = "0501234567"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:3001/api/create-patient" `
  -Method Post `
  -Body $body `
  -ContentType "application/json"
```

### cURL (Linux/Mac):
```bash
curl -X POST http://localhost:3001/api/create-patient \
  -H "Content-Type: application/json" \
  -d '{
    "name": "ูุญูุฏ ุฃุญูุฏ",
    "phone": "0501234567"
  }'
```

### Postman:
1. Method: `POST`
2. URL: `http://localhost:3001/api/create-patient`
3. Headers: `Content-Type: application/json`
4. Body (raw, JSON):
   ```json
   {
     "name": "ูุญูุฏ ุฃุญูุฏ",
     "phone": "0501234567"
   }
   ```

---

## โ๏ธ ุงููุชุทูุจุงุช

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
ูุฌุจ ุชูููุฐ ูุฐุง ูู Supabase SQL Editor:
```sql
CREATE TABLE IF NOT EXISTS patients (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    email VARCHAR(255),
    date_of_birth DATE,
    gender VARCHAR(20),
    address TEXT,
    medical_history TEXT,
    allergies TEXT,
    notes TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_patients_phone ON patients(phone);
```

ุฃู ุงุณุชุฎุฏู ุงูููู ุงูุฌุงูุฒ: `supabase_setup.sql`

### 2. ูุชุบูุฑุงุช ุงูุจูุฆุฉ
ุชุฃูุฏ ูู ููู `server/.env`:
```env
SUPABASE_URL=https://dnzuljmguutvummtwljj.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
PORT=3001
```

### 3. ุชุดุบูู ุงูุณูุฑูุฑ
```bash
cd server
npm install
npm start
```

ูุฌุจ ุฃู ุชุฑู:
```
๐ Dental Clinic API Server running on port 3001
๐ http://localhost:3001
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

ุจุนุฏ ุฅูุดุงุก ุงููุฑูุถุ ููููู:

1. **ุฅูุดุงุก ููุนุฏ ูููุฑูุถ**
   ```
   POST /api/appointments/create
   ```

2. **ุงูุจุญุซ ุนู ุงููุฑูุถ**
   ```
   GET /api/patients/:id
   ```

3. **ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฃููุฏ**
   ุนุจุฑ Evolution API

4. **ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ**
   (ูููู ุฅุถุงูุฉ endpoint ููุชุญุฏูุซ ูุงุญูุงู)

---

## ๐ ุงููููุงุช ุงููุฑุฌุนูุฉ

| ุงูููู | ุงููุตู |
|-------|-------|
| `API_CREATE_PATIENT_AR.md` | ุฏููู ุดุงูู ููุตู |
| `QUICK_API_REFERENCE.md` | ูุฑุฌุน ุณุฑูุน |
| `server/API_ENDPOINTS.md` | ุชูุซูู ุฌููุน APIs |
| `n8n-workflows/create-patient-workflow.json` | Workflow ุจุณูุท |
| `n8n-workflows/whatsapp-create-patient-example.json` | Workflow ูุชูุฏู ูุน WhatsApp |

---

## โจ ุงูููุฎุต

ุชู ุฅูุดุงุก API endpoint ูุงูู ููุชูุงูู ูุฅุถุงูุฉ ุงููุฑุถู ูุน:
- โ ุงูุชุญูู ูู ุงูุจูุงูุงุช
- โ ููุน ุงูุชูุฑุงุฑ
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- โ ุชูุซูู ุดุงูู
- โ ุฃูุซูุฉ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู
- โ Workflows ุฌุงูุฒุฉ ูู n8n

**ุงูู API ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุขู!** ๐

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 14 ูุจุฑุงูุฑ 2024
