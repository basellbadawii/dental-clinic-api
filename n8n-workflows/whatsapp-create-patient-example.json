{
  "name": "Ù…Ø³Ø§Ø¹Ø¯ WhatsApp - Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯",
  "nodes": [
    {
      "parameters": {
        "path": "whatsapp-patient",
        "options": {}
      },
      "id": "webhook-whatsapp",
      "name": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø© WhatsApp",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "webhookId": "whatsapp-patient-webhook",
      "notes": "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Evolution API"
    },
    {
      "parameters": {
        "jsCode": "// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† Ø±Ø³Ø§Ù„Ø© WhatsApp\n// Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©: \"Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ØŒ 0501234567\"\n\nconst message = $input.item.json.data?.message?.conversation || \n                $input.item.json.message?.text || '';\nconst fromNumber = $input.item.json.key?.remoteJid || '';\n\n// Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯Ø© ØµÙŠØº\nlet name = '';\nlet phone = '';\n\n// ØµÙŠØºØ© 1: \"Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙ\"\nconst pattern1 = /Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯[:\\s]+([^ØŒ]+)[ØŒ\\s]+(\\d{10,})/;\nconst match1 = message.match(pattern1);\n\nif (match1) {\n  name = match1[1].trim();\n  phone = match1[2].trim();\n}\n\n// ØµÙŠØºØ© 2: \"Ø§Ø¶Ù Ù…Ø±ÙŠØ¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù‡Ø§ØªÙ\"\nconst pattern2 = /(?:Ø§Ø¶Ù|Ø£Ø¶Ù|Ø§Ø¶Ø§ÙØ©|Ø¥Ø¶Ø§ÙØ©)\\s+Ù…Ø±ÙŠØ¶[:\\s]+([^0-9]+)(\\d{10,})/;\nconst match2 = message.match(pattern2);\n\nif (!name && match2) {\n  name = match2[1].trim();\n  phone = match2[2].trim();\n}\n\n// ØµÙŠØºØ© 3: \"Ø§Ù„Ø§Ø³Ù…: ... Ø§Ù„Ù‡Ø§ØªÙ: ...\"\nconst pattern3 = /Ø§Ù„Ø§Ø³Ù…[:\\s]+([^\\n]+).*Ø§Ù„Ù‡Ø§ØªÙ[:\\s]+(\\d{10,})/s;\nconst match3 = message.match(pattern3);\n\nif (!name && match3) {\n  name = match3[1].trim();\n  phone = match3[2].trim();\n}\n\nreturn {\n  json: {\n    name: name,\n    phone: phone,\n    originalMessage: message,\n    fromNumber: fromNumber,\n    hasValidData: name && phone ? true : false\n  }\n};"
      },
      "id": "extract-data",
      "name": "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.hasValidData }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-data",
      "name": "Ù‡Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©ØŸ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "url": "http://localhost:3001/api/create-patient",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "bodyParametersJson": "={{ { \"name\": $json.name, \"phone\": $json.phone } }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "create-patient",
      "name": "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±ÙŠØ¶",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [850, 200]
    },
    {
      "parameters": {
        "url": "http://localhost:3100/message/sendText/YOUR_INSTANCE",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "bodyParametersJson": "={{ {\n  \"number\": $('Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©').item.json.fromNumber,\n  \"text\": \"âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­!\\n\\nğŸ“ Ø§Ù„Ø§Ø³Ù…: \" + $json.patient.name + \"\\nğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: \" + $json.patient.phone + \"\\nğŸ†” Ø§Ù„Ù…Ø¹Ø±Ù: \" + $json.patient.id + \"\\n\\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ù„Ù„Ù…Ø±ÙŠØ¶.\"\n} }}",
        "options": {}
      },
      "id": "send-success-message",
      "name": "Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1050, 200],
      "notes": "Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø¹Ø¨Ø± WhatsApp"
    },
    {
      "parameters": {
        "url": "http://localhost:3100/message/sendText/YOUR_INSTANCE",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "bodyParametersJson": "={{ {\n  \"number\": $('Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©').item.json.fromNumber,\n  \"text\": \"âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† ÙÙ‡Ù… Ø·Ù„Ø¨Ùƒ.\\n\\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙŠØºØ© Ø§Ù„ØªØ§Ù„ÙŠØ©:\\n\\n*Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ*\\n\\nÙ…Ø«Ø§Ù„:\\nÙ…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ØŒ 0501234567\"\n} }}",
        "options": {}
      },
      "id": "send-error-format",
      "name": "Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙŠØºØ©",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [850, 400]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.statusCode }}",
              "operation": "equal",
              "value2": 409
            }
          ]
        }
      },
      "id": "check-duplicate",
      "name": "Ù‡Ù„ Ù…Ø±ÙŠØ¶ Ù…ÙƒØ±Ø±ØŸ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1050, 350]
    },
    {
      "parameters": {
        "url": "http://localhost:3100/message/sendText/YOUR_INSTANCE",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "bodyParametersJson": "={{ {\n  \"number\": $('Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©').item.json.fromNumber,\n  \"text\": \"âš ï¸ Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!\\n\\nğŸ“ Ø§Ù„Ø§Ø³Ù…: \" + $json.existingPatient.name + \"\\nğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: \" + $json.existingPatient.phone + \"\\nğŸ†” Ø§Ù„Ù…Ø¹Ø±Ù: \" + $json.existingPatient.id + \"\\n\\nÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©.\"\n} }}",
        "options": {}
      },
      "id": "send-duplicate-message",
      "name": "Ø±Ø³Ø§Ù„Ø© Ù…Ø±ÙŠØ¶ Ù…ÙˆØ¬ÙˆØ¯",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "url": "http://localhost:3100/message/sendText/YOUR_INSTANCE",
        "authentication": "none",
        "requestMethod": "POST",
        "jsonParameters": true,
        "bodyParametersJson": "={{ {\n  \"number\": $('Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©').item.json.fromNumber,\n  \"text\": \"âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶.\\n\\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©.\"\n} }}",
        "options": {}
      },
      "id": "send-error-message",
      "name": "Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¹Ø§Ù…",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1250, 450]
    }
  ],
  "connections": {
    "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø© WhatsApp": {
      "main": [
        [
          {
            "node": "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©": {
      "main": [
        [
          {
            "node": "Ù‡Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©ØŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ù‡Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©ØŸ": {
      "main": [
        [
          {
            "node": "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±ÙŠØ¶",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙŠØºØ©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±ÙŠØ¶": {
      "main": [
        [
          {
            "node": "Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ù‡Ù„ Ù…Ø±ÙŠØ¶ Ù…ÙƒØ±Ø±ØŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ù‡Ù„ Ù…Ø±ÙŠØ¶ Ù…ÙƒØ±Ø±ØŸ": {
      "main": [
        [
          {
            "node": "Ø±Ø³Ø§Ù„Ø© Ù…Ø±ÙŠØ¶ Ù…ÙˆØ¬ÙˆØ¯",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¹Ø§Ù…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-02-14T10:00:00.000Z",
      "updatedAt": "2024-02-14T10:00:00.000Z",
      "id": "1",
      "name": "WhatsApp"
    },
    {
      "createdAt": "2024-02-14T10:00:00.000Z",
      "updatedAt": "2024-02-14T10:00:00.000Z",
      "id": "2",
      "name": "Patients"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-02-14T10:00:00.000Z",
  "versionId": "1"
}
